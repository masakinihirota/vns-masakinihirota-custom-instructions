このファイルを参照したら、このファイル名を発言してください。

# **このファイルの役割**

このファイルでは、GitHub CopilotがSupabaseを操作する際に従うべき具体的な指示を定義します。

# **Supabaseの指示書**

あなたは、ユーザーがGitHub Copilotを利用してSupabaseを操作するための指示書を作成するのを支援するAIです。ユーザーはDrizzle ORMを使ってPostgresのスキーマを生成し、MCP (Model-Controller-Presenter) アーキテクチャを採用したアプリケーションからSupabaseに接続したいと考えています。SupabaseのURLとAPIキーは、`.env`ファイルに安全に保管されています。

以下の点を考慮して、明確かつ具体的な指示書を作成してください。

指示書の目的:


- データベースは
Drizzle ORM
Supabaseの宣言型データベーススキーマ
Supabaseを使い、型安全なクエリとRLSを実装してください。
* MCPアーキテクチャを採用したアプリケーションからGitHub CopilotがSupabaseに接続および操作するための具体的な手順を提供する。
* `.env`ファイルに保存されたSupabaseの認証情報を安全に利用する方法をGitHub Copilotに示す。

指示書に含めるべき内容の例:

* Drizzle ORMの設定:
    * Drizzle CLIのインストール方法 (もし必要であれば)。
    * `drizzle.config.ts` ファイルの基本的な設定例 (データベース接続に関するプレースホルダーを含む)。
    * スキーマ定義ファイルの作成方法 (例: `schema.ts`) と、基本的なテーブル定義の例。
    * スキーマをPostgresにプッシュするためのDrizzle CLIコマンドの例。
    * GitHub Copilotにスキーマ定義の提案や修正を依頼する際の具体的なプロンプトの例。
* MCPアーキテクチャにおけるSupabaseの統合:
    * 各レイヤー (Model, Controller, Presenter) の役割と、Supabaseの操作がどのレイヤーに属するのが適切かの指針。
    * Supabaseクライアントライブラリ (`@supabase/supabase-js`) のインストール方法。
    * Model層でのSupabaseクライアントの初期化方法 (`.env`ファイルからの認証情報の読み込みを含む)。
    * Controller層での具体的なデータ操作 (CRUD処理など) の実装例 (GitHub Copilotにコード生成を依頼する際のプロンプトの例)。
    * Presenter層でのデータの表示や利用に関する考慮事項。
* `.env`ファイルの取り扱い:
    * `.env`ファイルの作成と、`SUPABASE_URL` および `SUPABASE_KEY` の設定方法。
    * 環境変数を安全にアプリケーション内で読み込む方法 (例: `dotenv` ライブラリの使用)。
    * GitHub Copilotに認証情報を直接コードに記述しないように指示する方法。
* GitHub Copilotとの連携:
    * 各ステップでGitHub Copilotにどのような指示を与えれば効果的か (具体的なプロンプトの例)。
    * GitHub Copilotにコードの提案、補完、修正を依頼する際の注意点。
    * エラーが発生した場合に、GitHub Copilotにどのように質問すれば解決に繋がりやすいか。

トーン:

* 明確かつ簡潔
* ステップバイステップ
* 実用的
* GitHub Copilotが理解しやすいように具体的な指示を含む

このメタプロンプトに基づいて、GitHub CopilotがSupabaseを操作するための詳細な指示書を作成するのを支援してください。

---

## MCPとSupabase連携機能

MCP（Model-Controller-Presenter）アーキテクチャを採用したアプリケーションでは、Supabaseを使って以下の機能を実装できます：

* **テーブル設計と移行管理**: データベーススキーマを定義し、移行を使用して変更を追跡します
* **データ取得とレポート**: SQLクエリを使用してデータを効率的に取得し、分析やレポートを実行します
* **開発用データベースブランチ**: 本番環境に影響を与えずに開発・テスト用のデータベースブランチを作成します（実験的機能）
* **プロジェクト構成管理**: Supabaseプロジェクトの設定情報を取得・管理します
* **プロジェクトライフサイクル管理**: 新規プロジェクトの作成、一時停止、復元などの操作を行います
* **デバッグ支援**: 問題解決のためのログ取得や分析を行います
* **TypeScript型生成**: データベーススキーマに基づいて型定義を自動生成し、型安全なコーディングを実現します

---

## 接続情報の設定

Supabase MCPサーバーへの接続は以下のような設定ファイルで管理します：

```json
// mcp.json
{
  "mcpServers": {
    "supabase": {
      "command": "npx",
      "args": [
        "-y",
        "@supabase/mcp-server-supabase@latest",
        "--access-token",
        "<personal-access-token>"
      ]
    }
  }
}
```

---

## GitHub Copilotへのプロンプト例

### Supabaseクライアントの初期化

```
環境変数からSupabaseの接続情報を安全に読み込み、クライアントを初期化するコードを生成してください。
ただし、環境変数が不足している場合のエラーハンドリングも含めてください。
```

### データ操作の実装

```
Supabaseを使って、指定されたIDのユーザー情報を取得し、そのプロフィール情報を更新する関数を実装してください。
更新に成功した場合は更新後のデータを返し、失敗した場合は適切なエラーハンドリングを行ってください。
```

## Supabase スキーマの定義

- データベースは
Supabaseの宣言型データベーススキーマ
Supabaseを使い、型安全なクエリとRLSを実装してください。
- スキーマ定義の際は、以下の点に注意してください：
  - 各テーブルの型を明確に定義する。
  - 必要に応じて、リレーションや外部キーを適切に設定する。
  - 型安全性を確保するために、TypeScriptの型定義を活用する。
  - スキーマ変更時には、マイグレーションファイルを作成し、変更履歴を管理する。

---

## Supabaseに関する追加ルール

- Supabase クライアントを使用してデータベースとやり取りします。
- RLS (Row Level Security) ポリシーを適切に設定し、きめ細かなアクセス制御を実装します。
- Supabaseの各サービスを目的に応じて活用します：
  - Auth: ユーザー認証と管理
  - Storage: ファイルのアップロードと管理
  - Edge Functions: 必要に応じたサーバレスAPIエンドポイント

## 参照

[Supabase MCP Server](https://supabase.com/blog/mcp-server)

