---
applyTo: "**"
---

このファイルを参照したら、このファイル名を発言してください。

# GitHub Copilot コード生成指示書

## 1. はじめに

### 1.1. このファイルの役割
このファイルは、GitHub Copilot がコードを生成する際の指示を提供し、プロジェクト全体の一貫性と品質を維持することを目的とします。

### 1.2. エキスパートとしての振る舞い
以下の技術スタックに精通したエキスパートとして振る舞ってください。

-   **言語:** TypeScript, Node.js (最新LTSバージョン)
-   **フレームワーク/ライブラリ:** Next.js (最新バージョン、App Router、Server Components活用), React (最新バージョン)
-   **UI:** Shadcn/UI, Radix UI, Tailwind CSS (Radix UIベースでTailwind CSSでスタイリング)
-   **状態管理:** Zustand
-   **バックエンド/DB:** Supabase
-   **ORM:**
- データベースは
Drizzle ORM
Supabaseの宣言型データベーススキーマ
Supabaseを使い、型安全なクエリとRLSを実装してください。
-   **スキーマ検証:** Zod
-   **決済:** Stripe
-   **テスト:** Vitest, React Testing Library
-   **UI コンポーネント開発/管理:** Storybook
-   **API:** Hono (最新バージョン、Node.jsバックエンドで高速なAPIを提供)

## 2. プロジェクト全体のコーディング規約

### 2.1. 命名規則
-   **PascalCase:** コンポーネント名、インターフェース、型エイリアス。
-   **camelCase:** 変数、関数、メソッド。
-   **アンダースコアプレフィックス (`_`):** プライベートなクラスメンバー（クラスの使用は原則避けるため、適用場面は限定的です）。
-   **ALL_CAPS:** 定数。
-   **意味のある名前:** 変数名や関数名など、全ての命名においてその役割や目的が明確に分かるように、具体的かつ説明的な名前を選んでください。
-   **補助動詞:** `isLoading`, `hasError` のように、状態を表す変数は補助動詞を用いて説明的にします。

### 2.2. エラーハンドリング
-   **try/catchブロック:** 非同期処理 (`async/await`) では `try/catch` ブロックを使用してエラーを捕捉します。
-   **エラー境界 (Error Boundaries):** Reactコンポーネントにおいて適切なエラー境界を実装し、UIの一部で発生したエラーがアプリケーション全体に影響を与えないようにします。
-   **エラーログ:** エラー発生時には、問題の特定と解決を助けるために、発生箇所や状況がわかるコンテキスト情報を含めてエラーログを記録します。

### 2.3. コード生成の基本方針
-   **レビューと理解:** コードを記述する前に、既存のコードを深くレビューし、その動作を正確に理解します。
-   **簡潔性と正確性:** 正確な例を用い、簡潔で技術的に正しいTypeScriptコードを記述します。
-   **宣言的なJSX:** 読みやすく、意図が明確な宣言的なJSXを記述します。
-   **関数型・宣言型プログラミング:** 関数型および宣言型のプログラミングパターンを優先し、クラスベースの実装は避けます。
-   **ROROパターン (Receive an Object, Return an Object):** 必要に応じて、オブジェクトを受け取り、オブジェクトを返すROROパターンを使用します。
-   **ファイル構成要素:** エクスポートされるコンポーネント、サブコンポーネント、ヘルパー関数、静的コンテンツ、型定義などでファイルを構成します。
-   **ファイルサイズ:** 1ファイルの行数は500行以内を目安とし、これを超える場合は適切にファイルを分割します。
-   **コンポーネントのエクスポート:** コンポーネントは名前付きエクスポート (`export const MyComponent = ...`) を使用します。

### 2.4. ファイル・ディレクトリ構成
-   **コロケーションの採用:**
    -   Next.jsのApp Routerを使用し、コンポーネントのコロケーション（関連ファイルを同一ディレクトリに配置する戦略）を実践します。これにより、プロジェクトの保守性と可読性を向上させます。
    -   具体的には、1つのページとそのページで使用する複数のコンポーネント、およびそれらのテストファイルを同一のフォルダにまとめます。
-   **ディレクトリ名:** ケバブケース (例: `components/personal-information`) を使用します。
-   **ページ固有のデータフェッチ:**
    -   **場所:** `page.tsx` または `layout.tsx`
    -   **理由:** ページ全体で必要なデータを取得する場合、`page.tsx` または `layout.tsx` にフェッチ処理を記述します。これにより、ページ全体のデータ依存性が明確になります。
-   **コンポーネント固有のデータフェッチ:**
    -   **場所:** `ComponentA.logic.tsx` のようなロジック専用ファイル
    -   **理由:** 特定のコンポーネントでのみ必要なデータを取得する場合、ロジックを分離して `ComponentA.logic.tsx` に記述します。これにより、コンポーネントの責務が明確になります。
-   **具体的な構成例:**
    ```
    app/
      [page-name]/
        layout.tsx         // ページのレイアウトコンポーネント
        page.tsx           // ページコンポーネント
        common/            // 共通コンポーネントを格納するフォルダ
          CommonComponent.tsx       // 共通コンポーネント
          CommonComponent.logic.tsx // 共通コンポーネントのロジックを分離したファイル
          CommonComponent.test.tsx  // 共通コンポーネントのテストファイル
        components/        // ページ固有のコンポーネントを格納するフォルダ
          ComponentA.tsx
          ComponentA.logic.tsx      // ComponentAのロジックを分離したファイル
          ComponentA.test.tsx       // ComponentAのテストファイル
          ComponentB.tsx
          ComponentB.logic.tsx      // ComponentBのロジックを分離したファイル
          ComponentB.test.tsx       // ComponentBのテストファイル
        utils/             // (必要に応じてユーティリティ関数などを格納)
          helperFunctions.ts
        [page-name].test.tsx        // ページコンポーネントのテストファイル (任意)
    ```

## 3. UI/UX とアクセシビリティ

### 3.1. UI/UX 基本方針
-   **直感的なデザイン:** ユーザーインターフェースは直感的で使いやすく設計します。
-   **レスポンシブデザイン:** 様々なデバイス (PC、タブレット、スマートフォン) での表示を最適化するため、レスポンシブデザインを採用します。
-   **アニメーションとトランジション:** ユーザー体験を向上させるために、アニメーションやトランジションを適切かつ効果的に使用します。
-   **タグ入力の補完:** 一度入力したタグは、次回入力時に補完されるようにします。

### 3.2. アクセシビリティ
-   **キーボード操作:** 全てのインタラクティブな要素がキーボードのみで操作できるようにします。
-   **ARIA属性と役割:** コンポーネントに適切なARIA (Accessible Rich Internet Applications) ラベルと役割を実装し、支援技術による情報の伝達を正確にします。
-   **コントラスト比:** 色のコントラスト比がWCAG (Web Content Accessibility Guidelines) の基準を満たしていることを確認し、視覚障碍のあるユーザーにも配慮します。

## 4. 採用技術スタックと詳細な活用方針

### 4.1. Next.js と React
-   常に最新バージョンのReactとNext.jsを使用します。
-   Next.js App RouterのServer Componentsを積極的に活用し、パフォーマンスの高いWebアプリケーションを構築します。

### 4.2. Hono (API)
-   APIの実装には、軽量で高速なWebフレームワークであるHonoを使用します。
-   **ルーティング:** シンプルかつ直感的に記述します。
-   **ミドルウェア:** 認証やエラーハンドリングなどの共通処理は、Honoのミドルウェアを活用して効率的に実装します。
-   **型安全性:** TypeScriptの型定義を適切に使用し、型安全なAPI開発を徹底します。
-   **エコシステム活用:** 必要に応じて、Honoの提供するエコシステム (例: `hono/jwt`, `hono/cors`) を活用します。

### 4.3. Next.js サーバーアクション
-   Next.jsのサーバーアクションを積極的に使用します。
-   サーバーアクションを利用することで、クライアントサイドでの状態管理やAPI呼び出しを最小限に抑え、パフォーマンスとセキュリティを向上させます。
-   **入力バリデーション:** 入力データのバリデーションにはZodを使用します。
-   **エラー処理:** 適切なエラー処理を実装し、ユーザーに分かりやすいエラーメッセージを提供します。
-   **戻り値のモデル化:** サーバーアクションの戻り値として、成功時とエラー時の両方のケースを明確にモデル化します。

## 5. ドキュメンテーション

-   **コメント:** 複雑なロジックや理解が難しい箇所には、明確で簡潔なコメントを記述します。
-   **TSDoc:** IDEのインテリセンス (入力補完やヒント表示) を向上させるため、エクスポートされる関数やコンポーネントにはTSDoc形式のコメントを使用します。
-   **READMEファイル:** プロジェクトのREADMEファイルは常に最新の状態に保ち、セットアップ手順、プロジェクトの概要、主要な機能について記載します。
-   **Supabase関連ドキュメント:** Supabaseのスキーマ定義、RLS (Row Level Security) ポリシー、およびEdge関数を使用する場合は、それらの設計や意図に関するドキュメントを作成します。

---
