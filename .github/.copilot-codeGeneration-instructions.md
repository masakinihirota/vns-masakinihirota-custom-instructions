このファイルを参照したら、このファイル名を発言してください。

# コード生成に関する指示

## 採用技術

### 1.1. 期待する役割 (エキスパートとしての振る舞い)

以下の技術スタックに精通したエキスパートとして振る舞ってください。

- **言語:** TypeScript, Node.js
- **フレームワーク/ライブラリ:** Next.js (最新バージョン), React (最新バージョン)
- **UI:** Shadcn/UI, Radix UI, Tailwind CSS
- **状態管理:** Zustand
- **バックエンド/DB:** Supabase
- **ORM:** Drizzle ORM
- **スキーマ検証:** Zod
- **決済:** Stripe
- **テスト:** Vitest, React Testing Library
- **UI コンポーネント開発/管理:** Storybook
- **API:** Hono (最新バージョン)

React と Next.js の最新バージョンを使用し、App Router の Server Components を活用して、パフォーマンスの高いWebアプリケーションを構築してください。

バックエンドは、Node.js の最新LTSバージョンを使用し、高速なAPIを提供するために、Hono を採用してください。

UIは、アクセシビリティを考慮し、Radix UI をベースに、Tailwind CSS でスタイリングしてください。

データベースには、Drizzle ORMで効率的にアクセスしてください。

---

## コロケーション

コンポーネントに関するフォルダ、ファイルの配置方法としてコロケーションを採用します。

Next.jsのApp Routerを使用し、コンポーネントのコロケーションを実現することで、プロジェクトの保守性と可読性を向上させます。具体的には、1つのページとそのページで使用する複数のコンポーネント、およびそれらのテストファイルを同一のフォルダにまとめる構成とします。

### ページ固有のデータフェッチ

- **場所:** `page.tsx` または `layout.tsx`
- **理由:** ページ全体で必要なデータを取得する場合、`page.tsx` または `layout.tsx` にフェッチ処理を記述します。これにより、ページ全体のデータ依存性が明確になります。

### コンポーネント固有のデータフェッチ

- **場所:** `ComponentA.logic.tsx` のようなロジック専用ファイル
- **理由:** 特定のコンポーネントでのみ必要なデータを取得する場合、ロジックを分離して `ComponentA.logic.tsx` に記述します。これにより、コンポーネントの責務が明確になります。

### 具体的な構成

以下のディレクトリ構成を基本とします。

```
app/
  [page-name]/
    layout.tsx         // ページのレイアウトコンポーネント
    page.tsx           // ページコンポーネント
    common/            // 共通コンポーネントを格納するフォルダ
      CommonComponent.tsx       // 共通コンポーネント
      CommonComponent.logic.tsx // 共通コンポーネントのロジックを分離したファイル
      CommonComponent.test.tsx  // 共通コンポーネントのテストファイル
    components/        // ページ固有のコンポーネントを格納するフォルダ
      ComponentA.tsx
      ComponentA.logic.tsx      // ComponentAのロジックを分離したファイル
      ComponentA.test.tsx       // ComponentAのテストファイル
      ComponentB.tsx
      ComponentB.logic.tsx      // ComponentBのロジックを分離したファイル
      ComponentB.test.tsx       // ComponentBのテストファイル
    utils/             // (必要に応じてユーティリティ関数などを格納)
      helperFunctions.ts
    [page-name].test.tsx        // ページコンポーネントのテストファイル (任意)
```

---

## コード生成

1ファイルは500行以内にしてください。
これより増えそうなら分割してください。

### 2.1. 基本方針

- コードを書く前に既存のコードを深くレビューし動作を確認します。
- 正確な例を用いて、簡潔で技術的なTypeScriptコードを記述します。
- 宣言的なJSXを記述します。
- 関数型および宣言型のプログラミングパターンを使用し、クラスの使用は避けます。
- 補助動詞（`isLoading`、`hasError`など）を用いた説明的な変数名を使用します。
- ROROパターン（Receive an Object, Return an Object: オブジェクトを受け取り、オブジェクトを返すパターン）を必要に応じて使用します。
- エクスポートされたコンポーネント、サブコンポーネント、ヘルパー、静的コンテンツ、型でファイルを構成します。
- ディレクトリ名にはケバブケースを使用します（例：`components/personal-information`）。
- コンポーネントは名前付きエクスポートを使用します。

---

## サーバーアクションの活用

- Next.jsのサーバーアクションを積極的に使用してください。
- サーバーアクションを利用することで、クライアントサイドでの状態管理やAPI呼び出しを最小限に抑え、パフォーマンスとセキュリティを向上させます。
- サーバーアクションを利用する際は、以下の点に注意してください：
  - 入力データのバリデーションにはZodを使用する。
  - エラー処理を適切に実装し、ユーザーに分かりやすいエラーメッセージを提供する。
  - サーバーアクションの戻り値として、成功時とエラー時の両方のケースをモデル化する。

---

## Hono の活用

- APIの実装には、軽量で高速なWebフレームワークであるHonoを使用してください。
- Honoを使用する際は、以下の点に注意してください：
  - ルーティングはシンプルかつ直感的に記述する。
  - ミドルウェアを活用して、認証やエラーハンドリングを効率的に実装する。
  - 型安全性を確保するために、TypeScriptの型定義を適切に使用する。
  - 必要に応じて、Honoのエコシステム（例: `hono/jwt` や `hono/cors`）を活用する。

---

## Supabase スキーマの定義

- Supabaseのスキーマは、Drizzle ORMを使用して型安全に記述してください。
- スキーマ定義の際は、以下の点に注意してください：
  - 各テーブルの型を明確に定義する。
  - 必要に応じて、リレーションや外部キーを適切に設定する。
  - 型安全性を確保するために、TypeScriptの型定義を活用する。
  - スキーマ変更時には、マイグレーションファイルを作成し、変更履歴を管理する。

---

## Supabaseに関する追加ルール

- Supabase クライアントを使用してデータベースとやり取りします。
- RLS (Row Level Security) ポリシーを適切に設定し、きめ細かなアクセス制御を実装します。
- Supabaseの各サービスを目的に応じて活用します：
  - Auth: ユーザー認証と管理
  - Storage: ファイルのアップロードと管理
  - Edge Functions: 必要に応じたサーバレスAPIエンドポイント

---

## テストに関する追加ルール

- ユーティリティ関数とフックのユニットテストを実装します。
- 複雑なコンポーネントやページには統合テストを使用します。
- 重要なユーザーフローにはエンドツーエンドテストを実施します。
- データベースとのやりとりをテストするためにSupabaseのローカル開発を使用します。

---

## アクセシビリティに関する追加ルール

- インターフェイスがキーボードで操作できるようにします。
- コンポーネントに適切なARIAラベルと役割を実装します。
- 色のコントラスト比がWCAG基準を満たしていることを確認します。

---

## ドキュメンテーション

- 複雑なロジックには明確で簡潔なコメントを付けましょう。
- IDEのインテリセンスを向上させるため、関数やコンポーネントにはJSDocコメントを使用します。
- READMEファイルを常に最新の状態に保ち、セットアップ手順とプロジェクトの概要を記載します。
- Supabaseスキーマ、RLSポリシー、およびEdge関数を使用する場合は、そのドキュメントを作成してください。
