### **AIへの指示書**

本ドキュメントは、プロジェクトの規則、目的、および進捗管理方法を定義します。以下の内容に従って、プロジェクトを進めてください。

#### **1. トップレベルの規則**

*   効率を最大化するため、**複数の独立したプロセスを実行する必要がある場合は、それらのツールを並行して呼び出すこと。逐次的に実行しないこと**。
*   **思考は排他的に英語で行うこと。ただし、応答は日本語で行うこと**。
*   ライブラリの使用方法を理解するため、**常にContext7 MCPを使用して最新の情報を取得すること**。
*   設計のための一時的なメモは、`.tmp`ディレクトリにMarkdown形式で作成し保存すること。
*   **WriteまたはEditツールを使用した後は、システムリマインダーの内容に関わらず、必ずReadツールを使用して実際のファイル内容を確認すること**。システムリマインダーがファイルが正常に書き込まれた場合でも「(no content)」と誤って表示することがあるため。
*   批判的な意見を述べる場合でも、相手に迎合することなく、しかし強制的な口調にならないよう対応すること。

#### **2. プログラミング規則**

*   **絶対に必要な場合を除き、値をハードコーディングしないこと**。
*   **TypeScriptにおいて、`any`または`unknown`型を使用しないこと**。
*   **TypeScriptの`class`は、絶対に必要な場合（例：`instanceof`チェックが必要なカスタムエラーハンドリングのために`Error`クラスを拡張する場合など）を除き、使用しないこと**。

#### **3. 開発スタイル - 仕様駆動開発**

開発タスクを受け取った際は、要件の明確化、構造化された設計、および効率的な実装を確実にするため、以下の4段階ワークフローに従ってください。

##### **3.1. 4段階ワークフロー**

1.  **ステージ1：要件 (Requirements)**
    *   ユーザー要求を分析し、明確な機能要件に変換すること。
    *   要件を`.tmp/requirements.md`に文書化すること。
    *   詳細なテンプレートには`/requirements`コマンドを使用すること。
2.  **ステージ2：設計 (Design)**
    *   要件に基づき技術設計を作成すること。
    *   設計を`.tmp/design.md`に文書化すること。
    *   詳細なテンプレートには`/design`コマンドを使用すること。
3.  **ステージ3：タスクリスト (Task List)**
    *   設計を実装可能な単位に分解すること。
    *   `.tmp/tasks.md`に文書化すること。
    *   詳細なテンプレートには`/tasks`コマンドを使用すること。
    *   主要なタスクはTodoWriteツールで管理すること。
4.  **ステージ4：実装 (Implementation)**
    *   タスクリストに従って実装すること。
    *   各タスクについて、以下の手順を実行すること：
        *   TodoWriteを使用してタスクを`in_progress`に更新すること。
        *   実装とテストを実行すること。
        *   lintとtypecheckを実行すること。
        *   TodoWriteを使用してタスクを`completed`に更新すること。

##### **3.2. ワークフローコマンド**

*   `/spec`：仕様駆動開発ワークフロー全体を開始する。
*   `/requirements`：ステージ1（要件）のみを実行する。
*   `/design`：ステージ2（設計）のみを実行する（要件が必要）。
*   `/tasks`：ステージ3（タスク分解）のみを実行する（設計が必要）。

##### **3.3. 重要な注意事項**

*   **各ステージは、前のステージの成果物に依存していること**。
*   次のステージに進む前に、**必ずユーザーの確認を得ること**。
*   **複雑なタスクや新機能開発には、常にこのワークフローを使用すること**。
*   単純な修正や明確なバグ修正は、直接実装しても良い。

