# 大きな石理論に基づく開発プロセス指示書（AI連携版）

この指示書は、\*\*「大きな石理論」\*\*に基づき、開発プロセスの8割を人間が主導し、残りの2割をAIが補完・生成することで、効率的かつ高品質なソフトウェア開発を実現するためのガイドラインです。特に、AIが担当する部分（要件定義、設計、コード生成など）において、明確な指示と制約を設けることで、期待通りの成果を得ることを目指します。

-----

## 1\. 開発の基本方針とAIの役割

### 大きな石理論

  * **人間（開発者）**: プロジェクトのビジョン、戦略、主要な設計、複雑なビジネスロジック、全体的な品質管理、最終的な意思決定など、プロジェクトの「大きな石」となる8割の部分を担当します。創造性、経験、ドメイン知識を最大限に活用します。
  * **AI**: 人間が設定した明確な制約と指示に基づき、要件定義の具体化、設計の詳細化、特定のサブタスクにおけるコード生成、定型的な作業の自動化など、残りの2割の部分を効率的に実行します。

### 採用技術スタック（AI生成の制約）

AIは、以下の技術スタックのみを使用し、他のライブラリやフレームワークの導入は許可しません。 この制約により、AIの生成範囲を絞り込み、一貫性のある開発を促進します。

  * **Next.js**: フロントエンドフレームワーク（App Routerを優先）
  * **Supabase**: データベース（PostgreSQL）および認証バックエンド
  * **Drizzle ORM**: ORM（Object-Relational Mapper）
  * **Tailwind CSS**: CSSフレームワーク
  * **shadcn/ui**: UIコンポーネントライブラリ
  * **Zod**: スキーマバリデーションライブラリ
  * **Conform**: フォームライブラリ（Server Actionsとの相性を考慮）
  * **Zustand**: 軽量ステート管理ライブラリ（必要な場合のみ）

-----

## 2\. 開発プロセスのフェーズとAI連携

以下のフェーズで開発を進めます。各フェーズにおける人間の役割とAIの活用方法を明確にします。

### 2.1. 構想（人間主導）

  * **目的**: プロジェクトの根本的な目的、ビジョン、解決したい課題、ターゲットユーザー、提供価値を明確にする。
  * **人間の役割**:
      * ブレインストーミング、市場調査、ユーザーインタビューなどを通じて、プロジェクトの核となるアイデアを形成する。
      * ビジネス目標と技術的な実現可能性を考慮し、プロジェクトの方向性を決定する。
  * **AIの活用**: このフェーズではAIは直接コード生成を行いませんが、市場トレンド分析やアイデアの壁打ち、関連情報の収集などで補助的に利用できます。

-----

### 2.2. 概要（人間主導）

  * **目的**: 構想を具体化し、システム全体の主要な機能、ユーザー体験の概要、システム構成のイメージを記述する。
  * **人間の役割**:
      * 主要な機能リストの作成。
      * ユーザーシナリオやユースケースの検討。
      * システムアーキテクチャの概略図の作成。
  * **AIの活用**: 概要作成にあたり、類似システムの事例収集や、ユーザーシナリオの多様なパターン生成などで補助的に利用できます。

-----

### 2.3. 要件定義書（人間主導 + AI補助）

  * **目的**: ユーザーからの要求を機能要件、非機能要件として具体的に定義し、システムの振る舞いを明確にする。
  * **人間の役割（8割）**:
      * ユーザー要求の収集と分析。
      * 機能要件（例: ユーザー認証、データ登録/参照/更新/削除、検索機能など）の洗い出しと詳細化。
      * 非機能要件（例: 性能、セキュリティ、可用性、保守性、拡張性など）の定義。
      * ユースケース図、アクティビティ図など、要件を視覚的に表現する。
  * **AIへの指示（2割）**:
      * **プロンプト例**:

        ```
        あなたは経験豊富なシステムアナリストです。
        以下の概要と人間が記述した主要な機能リストに基づき、Next.js、Supabase、Drizzle ORM、Tailwind CSS、shadcn/ui、Zod、Conform、Zustand（必要な場合）の技術スタックを考慮した、より詳細な機能要件と非機能要件を提案してください。特に、Supabaseの認証機能やリアルタイム機能、Drizzle ORMのスキーマ定義、Tailwind CSSとshadcn/uiを用いたUI/UX、ZodとConformを用いたフォームバリデーションに関する要件を具体的に記述してください。

        [ここに人間が記述した概要と主要な機能リストを貼り付けます]

        出力形式:
        - 機能要件リスト（各要件にIDと詳細な説明、関連する技術スタックの示唆を含む）
        - 非機能要件リスト（性能、セキュリティ、可用性、保守性、拡張性に関する具体的な要件）
        ```
  * **AIの活用**: 人間が作成した概要と主要な機能リストを基に、より具体的な要件（特に技術スタックに紐づく部分）の提案、抜け漏れのチェック、表現の統一などをAIに依頼します。

-----

### 2.4. 設計書（人間主導 + AI補助）

  * **目的**: 要件定義書に基づき、システムの内部構造、コンポーネント間の連携、データ構造などを詳細に定義する。
  * **人間の役割（8割）**:
      * **DB設計**: SupabaseのPostgreSQLを考慮し、テーブル構造、カラム定義、データ型、主キー・外部キー、インデックス、リレーションシップ、RLS（Row Level Security）ポリシーの設計。
      * **画面設計**: 主要な画面のワイヤーフレーム、UIコンポーネントの構成、ユーザーフロー、インタラクションの設計。Next.jsのコンポーネント指向、Tailwind CSSとshadcn/uiの活用を意識する。
      * **URL設計**: Next.jsのファイルシステムベースルーティングを考慮した、RESTfulなURL構造の設計。
  * **AIへの指示（2割）**:
      * **プロンプト例**:

        ```
        あなたは経験豊富なソフトウェアアーキテクトです。
        以下の要件定義書と人間が作成した設計のたたき台に基づき、Next.js、Supabase、Drizzle ORM、Tailwind CSS、shadcn/ui、Zod、Conform、Zustand（必要な場合）の技術スタックに特化した、より詳細な設計を提案してください。

        [ここに人間が記述した要件定義書と設計のたたき台（例: 主要テーブル名、画面リスト、URLパターンなど）を貼り付けます]

        期待する出力:
        1.  **DBスキーマ定義（Drizzle ORM形式）**:
            * 人間が提案したテーブル構造に基づき、Drizzle ORMのスキーマ定義コード（`schema.ts`相当）を生成してください。
            * 各カラムのデータ型、制約（`notNull`, `primaryKey`など）、リレーションシップを正確に表現してください。
            * Supabaseの認証（`auth.users`）との連携を考慮した`profiles`テーブルなども含めてください。
        2.  **主要画面のコンポーネント構成（Next.js + shadcn/ui）**:
            * 人間が提案した画面設計に基づき、Next.jsのApp Routerにおける主要コンポーネント（例: `layout.tsx`, `page.tsx`, `components/`内のファイルなど）の役割と構成案を記述してください。
            * shadcn/uiのコンポーネントをどのように活用するか具体的に示唆してください。
            * データのフェッチ方法（サーバーコンポーネント vs クライアントコンポーネント）についても示唆してください。
        4.  **Supabase RLS（Row Level Security）ポリシーの提案**:
            * 主要なテーブルに対する基本的なRLSポリシー（例: ユーザー自身のデータのみアクセス可能）の考え方とSQL例を提案してください。
        5.  **フォームバリデーション（Zod + Conform）の設計**:
            * 主要なフォームにおけるZodスキーマの定義方法と、Conformでのフォーム制御の基本的な設計方針を提案してください。特にServer Actionsとの連携を考慮してください。
        ```
  * **AIの活用**: 人間が作成した設計のたたき台を元に、Drizzle ORMの具体的なスキーマ定義、Next.jsのコンポーネント構造、Supabase RLSの初期設定など、技術スタックに特化した詳細な設計案を生成させます。これにより、設計の具体化と一貫性を担保します。

-----

### 2.5. タスクリスト（人間主導）

  * **目的**: 設計書に基づき、開発に必要なタスクを細分化し、具体的な作業項目としてリストアップする。
  * **人間の役割**:
      * 機能ごと、または設計のコンポーネントごとに大まかなタスクを設定する。
      * 各タスクをさらに具体的なサブタスクに分解する。
      * 各サブタスクの担当者、優先度、見積もり時間などを設定する。
  * **AIの活用**: このフェーズではAIは直接コード生成を行いませんが、設計書から考えられるサブタスクの提案や、タスクの依存関係の分析などで補助的に利用できます。

-----

### 2.6. プロンプト（AIへの具体的な指示）

このフェーズは、AIに特定のサブタスクのコード生成や実装方針を依頼する際の、具体的な指示書となります。

```
あなたは経験豊富なフルスタック開発アシスタントです。
以下の技術スタックと制約を厳守し、指定されたサブタスクについて、具体的なコードまたは実装方針を生成してください。

---

**【AIへの指示の前提条件】**

* **利用技術スタック**:
    * フロントエンド: Next.js (App Router)
    * データベース/認証: Supabase (PostgreSQL)
    * ORM: Drizzle ORM
    * スタイリング: Tailwind CSS
    * UIコンポーネント: shadcn/ui
    * バリデーション: Zod
    * フォーム管理: Conform
    * ステート管理: Zustand (必要な場合のみ)
* **生成物の品質**:
    * 読みやすく、保守性が高く、ベストプラクティスに従っていること。
    * セキュリティ（例: Supabase RLSの考慮、環境変数の安全な利用、入力値のサニタイズ）に配慮すること。
    * 必要に応じて、考えられるエラーハンドリングや、実装上の注意点も記述すること。
    * **コメントを豊富に含め、コードの意図、各セクションの役割、重要なロジックを詳細に説明すること。**
* **出力形式**:
    * 要求されたコードは、指定されたファイルパス（例: `app/page.tsx`, `lib/db/schema.ts`など）を想定して生成すること。
    * コードブロックには適切な言語指定（`tsx`, `ts`, `sql`など）を使用すること。

---

**【具体的なサブタスクの指示】**

以下のテンプレートに従い、AIに依頼したいサブタスクの詳細を記述してください。

### サブタスク名: [ここにサブタスクの具体的な名称を記述]

* **目的**: [このサブタスクで何を達成したいかを明確に記述]
* **関連する設計情報**:
    * [関連するDBテーブル名、カラム名、データ型、リレーションシップなど]
    * [関連する画面のコンポーネント名、UI要素、ユーザーフローなど]
    * [関連するURLパスなど]
* **具体的な要件**:
    * [このサブタスクで実装すべき機能や振る舞いを箇条書きで詳細に記述]
    * [例: フォームの入力フィールドの種類とバリデーションルール]
    * [例: Supabaseのどのメソッドを使用するか（例: `supabase.auth.signUp`, `db.insert().values()`など）]
    * [例: Drizzle ORMでどのようなクエリを生成するか（例: `select`, `insert`, `update`, `delete`）]
    * [例: データの表示形式、ソート順、フィルタリング条件など]
    * [例: Tailwind CSSとshadcn/uiを使用して、どのようなスタイリングやコンポーネントを使用するか]
    * [例: Zodスキーマでどのようなバリデーションルールを定義するか]
    * [例: Conformでフォームの状態をどのように管理し、エラーを表示するか（特にServer Actionsとの連携）]
    * [例: Zustandでどのようなグローバルステートを定義し、どこで利用するか]
* **期待する出力**:
    * [生成してほしいコードのファイルパスと内容（例: `app/auth/signup/page.tsx`のフォームコンポーネント、`lib/actions.ts`のサーバーアクションなど）]
    * [実装方針のみで良い場合はその旨を記述]

---

**【サブタスク指示の例】**

#### サブタスク名: ユーザー登録機能のフロントエンドフォーム

* **目的**: 新規ユーザーがメールアドレスとパスワードで登録できるフォームを実装し、Supabaseの認証機能と連携してユーザーを登録する。
* **関連する設計情報**:
    * DB: `auth.users` (Supabase標準), `public.profiles` (id, username, created_at)
    * 画面: 登録ページ (`/signup`)
* **具体的な要件**:
    * Next.jsのクライアントコンポーネントとして、メールアドレスとパスワードの入力フィールド（確認用パスワードも含む）を持つフォームを実装。
    * **Tailwind CSSとshadcn/uiのInput、Buttonコンポーネントを使用してスタイリングする。**
    * **Zodスキーマでメールアドレス、パスワード、確認用パスワードのバリデーションルールを定義する。**
    * **Conformを使用してフォームの状態を管理し、Zodスキーマに基づいたバリデーションを行い、特にServer Actionsとの連携を考慮する。**
    * フォーム送信時に、Next.jsのサーバーアクションを呼び出す。
    * サーバー側では、Supabaseクライアントの`supabase.auth.signUp()`メソッドを使用してユーザーを登録する。
    * ユーザー登録成功後、`public.profiles`テーブルにDrizzle ORMを使用してユーザー名（メールアドレスから生成、または別途入力フィールドを用意）と`user_id`を挿入する。
    * エラー発生時には、ユーザーに分かりやすいメッセージを表示する。
* **期待する出力**:
    * `app/signup/page.tsx` (クライアントコンポーネントのフォーム)
    * `app/auth/actions.ts` (サーバーアクション)
    * `lib/validators/auth.ts` (Zodスキーマ定義)
```

-----

## 3\. 補足事項と考慮点

AIとの連携を円滑に進め、高品質な開発を行うために、以下の点も考慮してください。

### バージョン管理（Git）

人間が作成した要件定義書や設計書、タスクリスト、そしてAIが生成したコードはすべてGitでバージョン管理します。AIが生成したコードは、人間のレビューと承認を経てからメインブランチにマージします。

### テスト戦略

AIが生成したコードに対しても、人間が単体テスト、結合テスト、E2Eテストの計画と実行を行います。AIにテストコードの生成を依頼することも可能ですが、その場合も人間のレビューが必須です。

### デプロイメント

Next.jsアプリケーションのデプロイ戦略（Vercel, Netlifyなど）を計画します。Supabaseのデプロイと設定（データベース、認証、ストレージなど）も含まれます。

### AIとのフィードバックループ

AIが生成した内容に問題があった場合（例: 要件を満たしていない、バグがある、ベストプラクティスに従っていないなど）、具体的なフィードバックをAIに与え、修正を依頼します。より良い出力を得るために、プロンプトの改善を継続的に行います。

### セキュリティの徹底

AIが生成したコードであっても、セキュリティ脆弱性がないか人間が厳しくチェックします。特に、認証、認可、データアクセス、入力値のサニタイズに関する部分は慎重にレビューします。SupabaseのRLSは非常に強力なセキュリティ機能であるため、その設計と実装は人間が主導し、AIには具体的なSQL生成の補助を依頼する形が望ましいです。

### データ検証とエラーハンドリング

クライアントサイドとサーバーサイドの両方で、入力データの厳格な検証（バリデーション）を実装します。AI生成コードにも適切なエラーハンドリング（try-catchブロック、ユーザーへのフィードバック）が含まれるように指示します。

### ドキュメンテーション

AIが生成したコードや設計の一部も、必要に応じてドキュメンテーションに含めます。特に、AIが生成した複雑なロジックや特定の技術的な選択については、その背景や意図を人間が補足説明します。


